<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/CSS/nav.css" rel="stylesheet">
    <link href="/CSS/game.css" rel="stylesheet" />
    <link href="/CSS/plays.css" rel="stylesheet" />
</head>
<body>

    <header>
        <%- include('../Components/nav', { week: week, currentWeek:week}) %>
    </header>

    <main>
        <div class="game-container">
            <div class="left-section">
               <span> Raiders </span>
               <span> Score </span>
            </div>
            <div class="mid-section">
                <span class="period">2 </span>
                  <span class="clock"
                    >0.00</span>
                  <p class="match"> RAID VS GB </p>
            </div>
            <div class="right-section">
                <span> Score </span>
                <span> Greeen bay </span>
            </div>
        </div>
        <div id="plays">
            <% for(let i = 0; i < plays.length; i++) { %>
              <p><%= plays[i] %></p>
            <% } %>
          </div>
          
    </main>
    <script>
    const playsContainer = document.getElementById('plays');
    playsContainer.scrollTop = playsContainer.scrollHeight;
    const pathname = window.location.pathname;
    const pathSegments = pathname.split('/');
    const gameId = pathSegments[pathSegments.length - 1];

    const playsJSON = '<%- JSON.stringify(plays) %>'; 
    let prevPlays = undefined;
    try {
        prevPlays = JSON.parse(playsJSON);
    } catch (error) {
        console.error('Error parsing JSON:', error);
    }
    const playsSource = new EventSource(`/sse/plays/${gameId}`);
    playsSource.onmessage = (event) => {
        const data = JSON.parse(event.data);    

        let newPlays = [];
        for(let i = prevPlays.length; i < data.length;i++){
            newPlays.push(data[i]);
        }
        newPlays.forEach(playText => {
            const newPlayElement = document.createElement('p');
            newPlayElement.textContent = playText;
            playsContainer.appendChild(newPlayElement);
            playsContainer.scrollTop = playsContainer.scrollHeight;
        });
    };
    </script>
     <script src="/JS/nav.js"></script>
</body>
</html>